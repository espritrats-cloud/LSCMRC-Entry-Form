<!DOCTYPE html>
<html>
<head>
  <title>LSCMRC Rat Entry Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
   
    body {
      margin: 0;
      padding: 40px 10px;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }

    .form-shell {
      max-width: 900px;
      margin: 0 auto;
    }

    
    .form-card {
      background: #ffffff;
      border-radius: 12px;
      padding: 32px 32px 28px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      box-sizing: border-box; 
    }

    
    .form-header {
      text-align: center;
      margin-bottom: 24px;
    }

    .member-flags {
  margin-top: 16px;   
}

.member-flags span {
  display: block;
  margin-bottom: 6px; 
}

    .form-header img {
      max-width: 450px; 
      width: 100%;      
      height: auto;
      display: block;
      margin: 0 auto 12px;
    }

    /* Mobile tweaks */
    @media (max-width: 600px) {
      body { padding: 20px 8px; }

      .form-card {
        padding: 24px 16px 20px;
        border-radius: 10px;
      }

      .form-header img { max-width: 260px; }

      .two-col { grid-template-columns: 1fr; } 
    }

    .form-title {
      margin: 0;
      font-size: 1.6rem;
      letter-spacing: 0.06em;
      font-weight: bold;
    }

    .form-subtitle {
      margin: 8px auto 0;
      max-width: 640px;
      font-size: 0.9rem;
      color: #555;
      line-height: 1.4;
    }

    /* Helper text */
    .helper-text {
      font-size: 0.8rem;
      color: #666;
      margin-top: 4px;
      font-style: italic;
    }

    
    .section {
      margin-top: 24px;
      padding-top: 8px;
      border-top: 1px solid #e0e0e0;
    }

    .section:first-of-type {
      border-top: none;
      padding-top: 0;
      margin-top: 0;
    }

    .section h2 {
      margin: 0 0 10px;
      font-size: 1.1rem;
    }

    label {
      display: block;
      margin-top: 10px;
      font-size: 0.9rem;
    }

    input[type=text],
    input[type=email],
    input[type=number],
    select,
    textarea {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    
    .two-col {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px 24px;
    }

    
    .inline-options {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 0.9rem;
      align-items: center;
    }

    .inline-options label {
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: normal;
    }

    .subsection {
      margin-top: 10px;
      padding: 10px;
      border-left: 2px solid #aaa;
      background: #f9f9f9;
      border-radius: 6px;
    }

    .subsection-header {
      cursor: pointer;
      background: #e2e2e2;
      padding: 8px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 0.95rem;
    }

    .subsection-content { margin-top: 8px; }

    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .flex-row label {
      flex: 1;
      margin-top: 6px;
    }

    p { margin: 5px 0; }

    #totalCost {
      font-weight: bold;
      font-size: 18px;
    }

    /* Submit button */
    .submit-row {
      text-align: left;
      margin-top: 20px;
    }

    button[type=submit],
    button[type=button] {
      margin-top: 10px;
      padding: 10px 18px;
      font-size: 15px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background-color: #000;
      color: white;
    }

    button[type=button] {
      background-color: #444;
      font-size: 14px;
    }

    .hidden { display: none; }

    
    .exhibitor-bold label span { font-weight: bold; }
    
    .exhibitor-bold .member-flags span { font-weight: bold; }
    
    
    .sr-only {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }
  </style>
</head>

<body>
  <div class="form-shell">
    <form id="entryForm" class="form-card">
      <div class="form-header">
        <img src="savingPNG.png" alt="LSCMRC logo" />
        <h1 class="form-title">LSCMRC ENTRIES - RATS</h1>
        <p class="form-subtitle">
          The Rat Show Secretary will send you confirmation of your entries via email when the
          entries have been entered on to the show program. Entries close at 10pm on the Wednesday
          prior to the show.
        </p>
      </div>

      
      <!-- Use {{studName}}, {{varietySummary}}, {{petsSummary}}, {{hireTanksText}}, {{tankNumber}}, {{tankCost}}, {{totalCost}} -->
      <textarea class="sr-only" name="varietySummary" id="varietySummary" aria-hidden="true"></textarea>
      <textarea class="sr-only" name="petsSummary" id="petsSummary" aria-hidden="true"></textarea>
      <input class="sr-only" type="text" name="hireTanksText" id="hireTanksText" aria-hidden="true" />
      <input class="sr-only" type="text" name="tankCost" id="tankCostField" aria-hidden="true" />
      <input class="sr-only" type="text" name="totalCost" id="totalCostField" aria-hidden="true" />

      
      <div class="section exhibitor-bold">
        <h2>Exhibitor details</h2>

        
        <div class="two-col">
          <label><span>Name*:</span>
            <input type="text" name="memberName" required />
          </label>

          <label><span>Stud Name:</span>
            <!-- NOT required, because pets logic depends on whether this is blank or not -->
            <input type="text" name="studName" id="studName" />
          </label>
        </div>

        
        <div class="two-col">
          <label><span>Email*:</span>
            <input type="email" name="memberEmail" required />
          </label>

          <label><span>Phone:</span>
            <input type="text" name="phone" />
          </label>
        </div>

        
        <div class="two-col member-flags">
  <div>
    <span>LSCMRC Member</span>
    <div class="inline-options">
      <label><input type="checkbox" name="lscmrcMember" /> Yes</label>
    </div>
  </div>

  <div>
    <span>Junior (under 16)</span>
    <div class="inline-options">
      <label><input type="checkbox" name="junior" /> Yes</label>
    </div>
  </div>
</div>

      
      <div class="section">
        <h2>Hire Tanks</h2>
        <div class="inline-options">
          <label>
            <input type="checkbox" id="hireTanksCheckbox" name="hireTanks" />
            Do you require hire tanks?
          </label>
        </div>

        <div id="tankNumberDiv" class="hidden">
          <label>Number of tanks (max 2) @ £1.50 each:
            <input type="number" id="tankNumber" name="tankNumber" min="1" max="2" value="1" />
          </label>
          <p>Tank Cost: £<span id="tankCost">1.50</span></p>
        </div>
      </div>

      
      <div class="section">
        <h2>Show Entries</h2>
        <div class="inline-options">
          <label>
            <input type="checkbox" id="addVarietiesCheckbox" />
            Add Varieties?
          </label>
        </div>
        <div id="varietiesContainer" class="hidden"></div>
        <button type="button" id="addVarietyBtn" class="hidden">Add Another Exhibit</button>
        <p class="helper-text" id="varietyLimitMsg" style="display:none;">Maximum 10 exhibits reached.</p>
      </div>

      
      <div class="section">
        <h2>Pets</h2>
        <div class="inline-options">
          <label>
            <input type="checkbox" id="addPetsCheckbox" />
            Add Pets?
          </label>
        </div>
        <div id="petsContainer" class="hidden"></div>
        <button type="button" id="addPetBtn" class="hidden">Add Another Pet</button>
        <p class="helper-text" id="petLimitMsg" style="display:none;">Maximum 10 pets reached.</p>
      </div>

      
      <div class="section">
        <h2>Additional information</h2>
        <label>Any other information:
          <textarea name="otherInfo" rows="4"></textarea>
        </label>
        <p class="helper-text">
          Use this space to inform the show secretary of anything else relevant, e.g. bringing
          kittens to the show for collection etc.
        </p>
      </div>

      <!-- Total Cost -->
      <div class="section">
        <h2>Total Cost</h2>
        <p>Total Cost: £<span id="totalCost">0.00</span></p>
      </div>

      <div class="submit-row">
        <button type="submit">Submit</button>
      </div>
    </form>
  </div>

  <!-- EmailJS + logic -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    /***************  EMAILJS SETUP  ***************/
    emailjs.init('kGDNowkNSzNlhztoC'); // public key
    const EMAILJS_SERVICE_ID = 'service_wlaqz5n';
    const EMAILJS_TEMPLATE_ID = 'template_tjhgl4j';

    const MAX_EXHIBITS = 10;
    const MAX_PETS = 10;

    // DOM elements
    const studNameField      = document.getElementById('studName');

    const hireTanksCheckbox  = document.getElementById('hireTanksCheckbox');
    const tankNumberDiv      = document.getElementById('tankNumberDiv');
    const tankNumber         = document.getElementById('tankNumber');
    const tankCostSpan       = document.getElementById('tankCost');

    const totalCostDisplay   = document.getElementById('totalCost');

    const addVarietiesCheckbox = document.getElementById('addVarietiesCheckbox');
    const varietiesContainer   = document.getElementById('varietiesContainer');
    const addVarietyBtn        = document.getElementById('addVarietyBtn');
    const varietyLimitMsg      = document.getElementById('varietyLimitMsg');

    const addPetsCheckbox    = document.getElementById('addPetsCheckbox');
    const petsContainer      = document.getElementById('petsContainer');
    const addPetBtn          = document.getElementById('addPetBtn');
    const petLimitMsg        = document.getElementById('petLimitMsg');

    // Hidden fields for EmailJS
    const varietySummaryField = document.getElementById('varietySummary');
    const petsSummaryField    = document.getElementById('petsSummary');
    const hireTanksTextField  = document.getElementById('hireTanksText');
    const tankCostField       = document.getElementById('tankCostField');
    const totalCostField      = document.getElementById('totalCostField');

    // Cost counters
    let varietyCount = 0;
    let petCount = 0;

    /*************** Tank cost logic ***************/
    hireTanksCheckbox.addEventListener('change', () => {
      const checked = hireTanksCheckbox.checked;
      tankNumberDiv.classList.toggle('hidden', !checked);

      if (!checked) {
        
        tankNumber.value = '';
        tankCostSpan.innerText = '0.00';
      } else {
        if (!tankNumber.value) tankNumber.value = 1;
        updateTankCost();
      }

      updateTotalCost();
    });

    tankNumber.addEventListener('input', () => {
      updateTankCost();
      updateTotalCost();
    });

    function updateTankCost() {
      let num = parseInt(tankNumber.value);
      if (isNaN(num)) {
        tankCostSpan.innerText = '0.00';
        return;
      }
      num = Math.min(Math.max(num, 1), 2);
      tankNumber.value = num;
      tankCostSpan.innerText = (num * 1.5).toFixed(2);
    }

    /*************** Varieties logic ***************/
    addVarietiesCheckbox.addEventListener('change', () => {
      const checked = addVarietiesCheckbox.checked;

      varietiesContainer.classList.toggle('hidden', !checked);
      addVarietyBtn.classList.toggle('hidden', !checked);

      if (checked) {
        if (varietiesContainer.children.length === 0) addVariety();
      } else {
        varietiesContainer.innerHTML = '';
        varietyCount = 0;
        addVarietyBtn.disabled = false;
        varietyLimitMsg.style.display = 'none';
      }

      updateTotalCost();
    });

    addVarietyBtn.addEventListener('click', () => {
      addVariety();
      updateTotalCost();
    });

    function addVariety() {
      if (varietiesContainer.children.length >= MAX_EXHIBITS) {
        addVarietyBtn.disabled = true;
        varietyLimitMsg.style.display = 'block';
        return;
      }

      const div = document.createElement('div');
      div.className = 'subsection';
      const index = varietiesContainer.children.length;

      div.innerHTML = `
        <div class="subsection-header">Exhibit ${index + 1} (click to toggle)</div>
        <div class="subsection-content">
          <label>Rat Name:
            <input type="text" name="ratName${index}">
          </label>
          <div class="flex-row">
            <label>Age:
              <input type="radio" name="age${index}" value="Adult"> Adult
              <input type="radio" name="age${index}" value="Kitten"> Kitten
            </label>
            <label>Sex:
              <input type="radio" name="sex${index}" value="Doe"> Doe
              <input type="radio" name="sex${index}" value="Buck"> Buck
            </label>
          </div>
          <label>Section:
            <select name="section${index}" class="sectionSelect">
              <option value="">Select Section</option>
              <option value="Provisional Standard">Provisional Standard</option>
              <option value="Self">Self</option>
              <option value="Marked">Marked</option>
              <option value="Russian">Russian</option>
              <option value="Shaded">Shaded</option>
              <option value="AOV">AOV</option>
              <option value="Rex">Rex</option>
              <option value="Dumbo">Dumbo</option>
              <option value="Guide Standard">Guide Standard</option>
            </select>
          </label>
          <label>Class:
            <select name="class${index}" class="classSelect">
              <option value="">Select Section first</option>
            </select>
          </label>
          <label><input type="checkbox" name="novice${index}"> Novice</label>
          <label><input type="checkbox" name="dualEntry${index}"> Dual Entry (Pets)</label>
        </div>
      `;

      varietiesContainer.appendChild(div);
      varietyCount += 1;

      // Toggle open/close
      const header = div.querySelector('.subsection-header');
      const content = div.querySelector('.subsection-content');
      content.style.display = 'block';
      header.addEventListener('click', () => {
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      });

      // Populate class options by section
      const sectionSelect = div.querySelector('.sectionSelect');
      const classSelect   = div.querySelector('.classSelect');
      sectionSelect.addEventListener('change', () => {
        const options = getClassOptions(sectionSelect.value);
        classSelect.innerHTML = '';
        const first = document.createElement('option');
        first.value = '';
        first.innerText = options.length ? 'Select Class' : 'No classes available';
        classSelect.appendChild(first);

        options.forEach(opt => {
          const o = document.createElement('option');
          o.value = opt;
          o.innerText = opt;
          classSelect.appendChild(o);
        });
      });

      // Recalc when novice/dual toggled or when class changes
      const noviceCheckbox = div.querySelector(`input[name="novice${index}"]`);
      const dualCheckbox   = div.querySelector(`input[name="dualEntry${index}"]`);
      if (noviceCheckbox) noviceCheckbox.addEventListener('change', () => { updateTotalCost(); });
      if (dualCheckbox) dualCheckbox.addEventListener('change', () => { updateTotalCost(); });
      if (classSelect) classSelect.addEventListener('change', () => { updateTotalCost(); });

      // Limit button state
      if (varietiesContainer.children.length >= MAX_EXHIBITS) {
        addVarietyBtn.disabled = true;
        varietyLimitMsg.style.display = 'block';
      } else {
        addVarietyBtn.disabled = false;
        varietyLimitMsg.style.display = 'none';
      }
    }

    function getClassOptions(section) {
      const data = {
        "Provisional Standard": ["Bareback","Chestnut","Cinnamon Chinchilla","Copper","Dwarf","Merle","Pink Eyed Ivory","Powder Blue","Tonkinese (Self type)","Tonkinese (Agouti type)","Variegated Downunder"],
        "Self": ["Pink Eyed White","Champagne","Buff","Platinum","Quicksilver","British Blue","Black Chocolate","Mink","Ivory","Lilac"],
        "Marked": ["Berkshire/Badger","Irish","Hooded","Variegated","Capped","Essex","Chinchilla","Squirrel","Roan/Striped Roan"],
        "Russian": ["Russian Blue","Russian Dove","Russian Buff","Russian Blue Agouti","Russian Dove Agouti","Russian Silver","Russian Topaz"],
        "Shaded": ["Argente Crème","Himalayan","Siamese","Blue Point Siamese","Burmese","Wheaten Burmese","Golden Himalayan","Golden Siamese","Marten","Silver Agouti","Cream Agouti"],
        "AOV": ["Cream","Topaz","Silver Fawn","Silver","Agouti","Cinnamon","British Blue Agouti","Lilac Agouti","Pearl","Cinnamon Pearl","Platinum Agouti"],
        "Rex": ["Self","Marked","Russian","Shaded","AOV"],
        "Dumbo": ["Self","Marked","Russian","Shaded","AOV","Rex"],
        "Guide Standard": ["Blue Point Himalayan","Russian Burmese","Russian Silver Agouti","Sable Burmese","Spotted Down Under","Silken"]
      };
      return data[section] || [];
    }

    /*************** Pets logic ***************/
    addPetsCheckbox.addEventListener('change', () => {
      const checked = addPetsCheckbox.checked;

      petsContainer.classList.toggle('hidden', !checked);
      addPetBtn.classList.toggle('hidden', !checked);

      if (checked) {
        if (petsContainer.children.length === 0) addPet();
      } else {
        petsContainer.innerHTML = '';
        petCount = 0;
        addPetBtn.disabled = false;
        petLimitMsg.style.display = 'none';
      }

      updateTotalCost();
    });

    addPetBtn.addEventListener('click', () => {
      addPet();
      updateTotalCost();
    });

    function addPet() {
      if (petsContainer.children.length >= MAX_PETS) {
        addPetBtn.disabled = true;
        petLimitMsg.style.display = 'block';
        return;
      }

      const div = document.createElement('div');
      div.className = 'subsection';
      const index = petsContainer.children.length;

      div.innerHTML = `
        <div class="subsection-header">Pet ${index + 1} (click to toggle)</div>
        <div class="subsection-content">
          <label>Rat Name:
            <input type="text" name="petName${index}">
          </label>

          <label>Sex:
            <input type="radio" name="petSex${index}" value="Buck"> Buck
            <input type="radio" name="petSex${index}" value="Doe"> Doe
          </label>
        </div>
      `;

      petsContainer.appendChild(div);
      petCount += 1;

      const header = div.querySelector('.subsection-header');
      const content = div.querySelector('.subsection-content');
      content.style.display = 'block';
      header.addEventListener('click', () => {
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      });

      // Recalc when pet sex changes
      const sexRadios = div.querySelectorAll(`input[name="petSex${index}"]`);
      sexRadios.forEach(r => r.addEventListener('change', () => updateTotalCost()));

      if (petsContainer.children.length >= MAX_PETS) {
        addPetBtn.disabled = true;
        petLimitMsg.style.display = 'block';
      } else {
        addPetBtn.disabled = false;
        petLimitMsg.style.display = 'none';
      }
    }

    /*************** DOS-format builders ***************/
    function getAgeSexCode(age, sex) {
      const a = (age === 'Kitten') ? 'K' : 'A'; // default Adult if unset
      const s = (sex === 'Doe') ? 'D' : 'B';    // default Buck if unset
      return `${a}${s}`; // AB / AD / KB / KD
    }

    // Builds lines like:
    // 2AB SILVER FAWN  (no novice -> space)
    // 2KDNSILVER FAWN  (novice -> N replaces space)
    function buildVarietySummary() {
      const counts = new Map();

      for (let i = 0; i < varietiesContainer.children.length; i++) {
        const age = document.querySelector(`input[name="age${i}"]:checked`)?.value || '';
        const sex = document.querySelector(`input[name="sex${i}"]:checked`)?.value || '';
        const cls = document.querySelector(`select[name="class${i}"]`)?.value || '';

        // Only count if class chosen (prevents blank lines)
        if (!cls) continue;

        const ageSex = getAgeSexCode(age, sex);
        const novice = document.querySelector(`input[name="novice${i}"]`)?.checked ? 'N' : '';
        const classUpper = String(cls).toUpperCase();

        const key = `${ageSex}|${novice}|${classUpper}`;
        counts.set(key, (counts.get(key) || 0) + 1);
      }

      const lines = Array.from(counts.entries())
        .sort((a, b) => a[0].localeCompare(b[0]))
        .map(([key, count]) => {
          const [ageSex, noviceFlag, classUpper] = key.split('|');
          const separator = noviceFlag === 'N' ? '' : ' ';
          return `${count}${ageSex}${noviceFlag}${separator}${classUpper}`;
        });

      return lines.join('\n');
    }

    // Pets:
    // If stud name is filled -> BREEDER OWNED
    // If blank -> ADULT OWNED
    // Consolidate by sex:
    // 1   BREEDER OWNED B
    // 2   ADULT OWNED D
    function buildPetsSummary() {
      if (petsContainer.children.length === 0) return '';

      const studFilled = (studNameField.value || '').trim().length > 0;
      const ownedLabel = studFilled ? 'BREEDER OWNED' : 'ADULT OWNED';

      let buckCount = 0;
      let doeCount = 0;

      for (let i = 0; i < petsContainer.children.length; i++) {
        const sex = document.querySelector(`input[name="petSex${i}"]:checked`)?.value || '';
        if (sex === 'Doe') doeCount += 1;
        else if (sex === 'Buck') buckCount += 1;
      }

      const lines = [];
      if (buckCount > 0) lines.push(`${buckCount}   ${ownedLabel} B`);
      if (doeCount > 0) lines.push(`${doeCount}   ${ownedLabel} D`);
      return lines.join('\n');
    }

    /*************** Total cost ***************/
    function updateTotalCost() {
      let total = 0;

      // Tanks: £1.50 each, max 2
      if (hireTanksCheckbox.checked) {
        total += Math.min(parseInt(tankNumber.value) || 0, 2) * 1.5;
      }

      // £1 per variety and £1 per pet (using explicit counters)
      total += varietyCount + petCount;

      // +£1 for each Dual Entry (Pets) ticked
      const dualChecks = document.querySelectorAll('input[name^="dualEntry"]');
      dualChecks.forEach(cb => { if (cb.checked) total += 1; });

      totalCostDisplay.innerText = total.toFixed(2);
    }

    /*************** Form submission via EmailJS ***************/
    document.getElementById('entryForm').addEventListener('submit', function (event) {
      event.preventDefault();

      // Fill hidden fields that EmailJS will send
      const tanksText = hireTanksCheckbox.checked ? 'Yes' : 'No';
      hireTanksTextField.value = tanksText;

      // keep tankCost + totalCost as actual fields (EmailJS sends form fields, not spans)
      tankCostField.value = (tankCostSpan.innerText || '0.00').trim();
      totalCostField.value = (totalCostDisplay.innerText || '0.00').trim();

      // Consolidated DOS-format summaries
      varietySummaryField.value = buildVarietySummary();
      petsSummaryField.value = buildPetsSummary();

      emailjs.sendForm(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, this)
        .then(() => { alert('Entry submitted successfully!'); },
              (error) => { alert('Submission failed: ' + JSON.stringify(error)); });
    });
  </script>
</body>
</html>

