<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rat Club Entry Form</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 12px; max-width: 900px; margin: auto; background:#fff; color:#111; }
    h1 { text-align:center; margin-bottom:12px; }
    .section { margin-bottom:18px; padding:14px; border:1px solid #ddd; border-radius:8px; background:#fafafa; }
    label { display:block; margin-top:8px; font-weight:normal; }
    input[type=text], input[type=email], input[type=number], select, textarea {
      width:100%; padding:8px; margin-top:6px; box-sizing:border-box; border-radius:6px; border:1px solid #ccc;
    }
    .checkbox-row { display:flex; align-items:center; gap:8px; margin-top:8px; flex-wrap:wrap; }
    .btn { display:inline-block; margin-top:10px; padding:8px 12px; border-radius:6px; border:none; background:#2e7d32; color:#fff; cursor:pointer; }
    .btn.secondary { background:#1976d2; }
    .hidden { display:none; }
    .subsection { margin-top:10px; border-left:3px solid #e0e0e0; padding:10px 10px 10px 14px; background:#fff; border-radius:6px; }
    .subsection-header { font-weight:bold; background:#f0f0f0; padding:8px; border-radius:6px; cursor:pointer; }
    .subsection-content { padding-top:8px; }
    .small { font-size:0.95rem; color:#444; }
    #totalCost { font-weight:bold; font-size:1.1rem; }
    @media (max-width:520px){
      body { padding:8px; }
      .btn { width:100%; text-align:center; }
    }
  </style>
</head>
<body>
  <h1>Rat Club Exhibit Entry Form</h1>

  <form id="entryForm">

    <!-- Member Information -->
    <div class="section">
      <h2>Member Information</h2>
      <label>Name or Stud Name*:
        <input type="text" name="memberName" required>
      </label>
      <label>Email*:
        <input type="email" name="memberEmail" required>
      </label>
      <label>Phone:
        <input type="text" name="phone">
      </label>
      <div class="checkbox-row">
        <label><input type="checkbox" name="lscmrcMember"> LSCMRC Member</label>
        <label><input type="checkbox" name="junior"> Junior (under 16)</label>
      </div>
    </div>

    <!-- Hire Tanks -->
    <div class="section">
      <h2>Hire Tanks</h2>
      <label><input type="checkbox" id="hireTanksCheckbox" name="hireTanks"> Hire tanks required</label>
      <div id="tankNumberDiv" class="hidden">
        <label>Number of tanks (max 2) @ £1.50 each:
          <input type="number" id="tankNumber" name="tankNumber" min="1" max="2" value="1">
        </label>
        <p class="small">Tank cost: £<span id="tankCost">1.50</span></p>
      </div>
    </div>

    <!-- Show Entries -->
    <div class="section">
      <h2>Show Entries</h2>
      <label><input type="checkbox" id="addVarietiesCheckbox"> Add Varieties</label>
      <div id="varietiesContainer" class="hidden"></div>
      <button type="button" id="addVarietyBtn" class="btn secondary hidden">Add Another Exhibit</button>
    </div>

    <!-- Pets -->
    <div class="section">
      <h2>Pets</h2>
      <label><input type="checkbox" id="addPetsCheckbox"> Add Pets</label>
      <div id="petsContainer" class="hidden"></div>
      <button type="button" id="addPetBtn" class="btn secondary hidden">Add Another Pet</button>
    </div>

    <!-- Additional Information -->
    <div class="section">
      <h2>Additional Information</h2>
      <label>Other info:
        <textarea name="otherInfo" rows="4"></textarea>
      </label>
    </div>

    <!-- Total Cost -->
    <div class="section">
      <p id="totalCost">Total Cost: £0.00</p>
    </div>

    <!-- Submit -->
    <div class="section">
      <button class="btn" type="submit">Submit Entry</button>
    </div>
  </form>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    // Replace with your EmailJS user/service/template IDs
    emailjs.init('YOUR_EMAILJS_USER_ID'); // e.g. 'user_XXXXXXXX'
    const SERVICE_ID = 'YOUR_SERVICE_ID';
    const TEMPLATE_ID = 'YOUR_TEMPLATE_ID';

    // DOM references
    const hireTanksCheckbox = document.getElementById('hireTanksCheckbox');
    const tankNumberDiv = document.getElementById('tankNumberDiv');
    const tankNumber = document.getElementById('tankNumber');
    const tankCost = document.getElementById('tankCost');
    const totalCostEl = document.getElementById('totalCost');

    const addVarietiesCheckbox = document.getElementById('addVarietiesCheckbox');
    const varietiesContainer = document.getElementById('varietiesContainer');
    const addVarietyBtn = document.getElementById('addVarietyBtn');

    const addPetsCheckbox = document.getElementById('addPetsCheckbox');
    const petsContainer = document.getElementById('petsContainer');
    const addPetBtn = document.getElementById('addPetBtn');

    // Initialize
    function updateTankCostDisplay(){
      const num = Math.min(Math.max(parseInt(tankNumber.value) || 1, 1), 2);
      tankCost.textContent = (num * 1.5).toFixed(2);
    }

    hireTanksCheckbox.addEventListener('change', () => {
      tankNumberDiv.classList.toggle('hidden', !hireTanksCheckbox.checked);
      updateTankCostDisplay();
      updateTotalCost();
    });
    tankNumber.addEventListener('input', () => { updateTankCostDisplay(); updateTotalCost(); });

    // Varieties handling (collapsible entries)
    addVarietiesCheckbox.addEventListener('change', () => {
      varietiesContainer.classList.toggle('hidden', !addVarietiesCheckbox.checked);
      addVarietyBtn.classList.toggle('hidden', !addVarietiesCheckbox.checked);
      if (addVarietiesCheckbox.checked && varietiesContainer.children.length === 0) addVariety();
      updateTotalCost();
    });
    addVarietyBtn.addEventListener('click', () => { addVariety(); updateTotalCost(); });

    function addVariety(){
      const index = varietiesContainer.children.length;
      const div = document.createElement('div');
      div.className = 'subsection';
      div.innerHTML = `
        <div class="subsection-header">Exhibit ${index + 1} (click to toggle)</div>
        <div class="subsection-content">
          <label>Rat Name:<input type="text" name="ratName${index}"></label>

          <label>Age:</label>
          <label><input type="radio" name="age${index}" value="Adult"> Adult (14+ weeks)</label>
          <label><input type="radio" name="age${index}" value="Kitten"> Kitten (under 14 weeks)</label>

          <label>Sex:</label>
          <label><input type="radio" name="sex${index}" value="Doe"> Doe</label>
          <label><input type="radio" name="sex${index}" value="Buck"> Buck</label>

          <label>Section:
            <select name="section${index}" class="sectionSelect">
              <option value="">Select Section</option>
              <option>Provisional Standard</option>
              <option>Self</option>
              <option>Marked</option>
              <option>Russian</option>
              <option>Shaded</option>
              <option>AOV</option>
              <option>Rex</option>
              <option>Dumbo</option>
              <option>Guide Standard</option>
            </select>
          </label>

          <label>Class:
            <select name="class${index}" class="classSelect"><option value="">Select Section first</option></select>
          </label>

          <label><input type="checkbox" class="noviceCheck" name="novice${index}"> Novice</label>
          <label><input type="checkbox" class="dualCheck" name="dualEntry${index}"> Dual Entry (Pets)</label>
        </div>
      `;
      varietiesContainer.appendChild(div);

      // Collapsible behaviour
      const header = div.querySelector('.subsection-header');
      const content = div.querySelector('.subsection-content');
      header.addEventListener('click', () => {
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      });

      // Update class options based on section
      const sectionSelect = div.querySelector('.sectionSelect');
      const classSelect = div.querySelector('.classSelect');
      sectionSelect.addEventListener('change', () => {
        const options = getClassOptions(sectionSelect.value);
        classSelect.innerHTML = '';
        options.forEach(opt => {
          const o = document.createElement('option');
          o.value = opt; o.innerText = opt;
          classSelect.appendChild(o);
        });
      });

      // When dual checkbox toggled, update total
      const dualBox = div.querySelector('.dualCheck');
      dualBox.addEventListener('change', updateTotalCost);

      updateTotalCost();
    }

    function getClassOptions(section){
      const data = {
        "Provisional Standard": ["Bareback","Chestnut","Cinnamon Chinchilla","Copper","Dwarf","Merle","Pink Eyed Ivory","Powder Blue","Tonkinese (Self type)","Tonkinese (Agouti type)","Variegated Downunder"],
        "Self": ["Pink Eyed White","Champagne","Buff","Platinum","Quicksilver","British Blue","Black Chocolate","Mink","Ivory","Lilac"],
        "Marked": ["Berkshire/Badger","Irish","Hooded","Variegated","Capped","Essex","Chinchilla","Squirrel","Roan/Striped Roan"],
        "Russian": ["Russian Blue","Russian Dove","Russian Buff","Russian Blue Agouti","Russian Dove Agouti","Russian Silver","Russian Topaz"],
        "Shaded": ["Argente Crème","Himalayan","Siamese","Blue Point Siamese","Burmese","Wheaten Burmese","Golden Himalayan","Golden Siamese","Marten","Silver Agouti","Cream Agouti"],
        "AOV": ["Cream","Topaz","Silver Fawn","Silver","Agouti","Cinnamon","British Blue Agouti","Lilac Agouti","Pearl","Cinnamon Pearl","Platinum Agouti"],
        "Rex": ["Self","Marked","Russian","Shaded","AOV"],
        "Dumbo": ["Self","Marked","Russian","Shaded","AOV","Rex"],
        "Guide Standard": ["Blue Point Himalayan","Russian Burmese","Russian Silver Agouti","Sable Burmese","Spotted Down Under","Silken"]
      };
      return data[section] || [];
    }

    // Pets handling
    addPetsCheckbox.addEventListener('change', () => {
      petsContainer.classList.toggle('hidden', !addPetsCheckbox.checked);
      addPetBtn.classList.toggle('hidden', !addPetsCheckbox.checked);
      if (addPetsCheckbox.checked && petsContainer.children.length === 0) addPet();
      updateTotalCost();
    });
    addPetBtn.addEventListener('click', () => { addPet(); updateTotalCost(); });

    function addPet(){
      const index = petsContainer.children.length;
      const div = document.createElement('div');
      div.className = 'subsection';
      div.innerHTML = `
        <div class="subsection-header">Pet ${index + 1} (click to toggle)</div>
        <div class="subsection-content">
          <label>Rat Name:<input type="text" name="petName${index}"></label>
          <label>Section:
            <select name="petSection${index}">
              <option value="">Select Section</option>
              <option>Adult Owned</option>
              <option>Junior Owned</option>
              <option>Breeder Owned</option>
            </select>
          </label>
          <label>Sex:</label>
          <label><input type="radio" name="petSex${index}" value="Buck"> Buck</label>
          <label><input type="radio" name="petSex${index}" value="Doe"> Doe</label>
        </div>
      `;
      petsContainer.appendChild(div);

      const header = div.querySelector('.subsection-header');
      const content = div.querySelector('.subsection-content');
      header.addEventListener('click', () => {
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
      });

      updateTotalCost();
    }

    // Total cost calculation with Dual Entry extra
    function updateTotalCost(){
      let total = 0;

      // Tanks
      if (hireTanksCheckbox.checked){
        const tanks = Math.min(Math.max(parseInt(tankNumber.value) || 0, 0), 2);
        total += tanks * 1.5;
      }

      // Varieties: base £1 each + £1 extra if dual checked
      const varietyEntries = varietiesContainer.querySelectorAll('.subsection');
      varietyEntries.forEach(div => {
        // each entry base £1
        total += 1;
        const dual = div.querySelector('.dualCheck');
        if (dual && dual.checked) total += 1; // add £1 for dual entry if checked
      });

      // Pets: base £1 each
      const petEntries = petsContainer.querySelectorAll('.subsection');
      petEntries.forEach(() => { total += 1; });

      totalCostEl.textContent = 'Total Cost: £' + total.toFixed(2);
    }

    // Attach update listeners to dynamic additions
    // Some events are already attached when adding entries - also keep a small interval to update totals for safety
    setInterval(updateTotalCost, 800);

    // Form submission via EmailJS
    document.getElementById('entryForm').addEventListener('submit', function(e){
      e.preventDefault();

      // If you want to inspect values before sending, you could console.log the form data here.

      emailjs.sendForm(SERVICE_ID, TEMPLATE_ID, this)
        .then(function(){ alert('Entry submitted — thank you!'); },
              function(error){ alert('Submission failed: ' + JSON.stringify(error)); });
    });

    // initial display state
    updateTankCostDisplay();
    updateTotalCost();
  </script>
</body>
</html>
