<!DOCTYPE html>
<html>
<head>
  <title>Rat Club Entry Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; max-width: 800px; margin: auto; }
    h1 { text-align: center; }
    .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
    label { display: block; margin-top: 10px; }
    input[type=text], input[type=email], input[type=number], select, textarea { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 10px 16px; font-size: 16px; cursor: pointer; border-radius: 6px; border: none; background-color: #4CAF50; color: white; }
    .hidden { display: none; }
    .subsection { margin-left: 10px; margin-top: 10px; padding: 10px; border-left: 2px solid #aaa; background: #f9f9f9; border-radius: 6px; }
    .subsection-header { cursor: pointer; background: #e2e2e2; padding: 8px; border-radius: 4px; font-weight: bold; }
    .flex-row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .flex-row label { flex: 1; }
    p { margin: 5px 0; }
    #totalCost { font-weight: bold; font-size: 18px; }
  </style>
</head>
<body>

<h1>Rat Club Exhibit Entry Form</h1>

<form id="entryForm">

  <!-- Member Information -->
  <div class="section">
    <h2>Member Information</h2>
    <label>Name or Stud Name*:
      <input type="text" name="memberName" required>
    </label>
    <label>Email*:
      <input type="email" name="memberEmail" required>
    </label>
    <label>Phone:
      <input type="text" name="phone">
    </label>
    <label><input type="checkbox" name="lscmrcMember"> LSCMRC Member</label>
    <label><input type="checkbox" name="junior"> Junior (under 16)</label>
  </div>

  <!-- Hire Tanks -->
  <div class="section">
    <h2>Hire Tanks</h2>
    <label><input type="checkbox" id="hireTanksCheckbox" name="hireTanks"> Hire tanks required</label>
    <div id="tankNumberDiv" class="hidden">
      <label>Number of tanks (max 2) @ £1.50 each:
        <input type="number" id="tankNumber" name="tankNumber" min="1" max="2" value="1">
      </label>
      <p>Tank Cost: £<span id="tankCost">1.50</span></p>
    </div>
  </div>

  <!-- Show Entries -->
  <div class="section">
    <h2>Show Entries</h2>
    <label><input type="checkbox" id="addVarietiesCheckbox"> Add Varieties</label>
    <div id="varietiesContainer" class="hidden"></div>
    <button type="button" id="addVarietyBtn" class="hidden">Add Another Exhibit</button>
  </div>

  <!-- Pets -->
  <div class="section">
    <h2>Pets</h2>
    <label><input type="checkbox" id="addPetsCheckbox"> Add Pets</label>
    <div id="petsContainer" class="hidden"></div>
    <button type="button" id="addPetBtn" class="hidden">Add Another Pet</button>
  </div>

  <!-- Additional Information -->
  <div class="section">
    <h2>Additional Information</h2>
    <label>Other info:
      <textarea name="otherInfo" rows="4"></textarea>
    </label>
  </div>

  <!-- Total Cost -->
  <div class="section">
    <p>Total Cost: £<span id="totalCost">0.00</span></p>
  </div>

  <button type="submit">Submit Entry</button>
</form>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  /***************  EMAILJS SETUP  ***************/
  emailjs.init('3ZKJ9Faj6dDLhNh5Y'); // public key

  const EMAILJS_SERVICE_ID = 'service_51m2sqm';
  const EMAILJS_TEMPLATE_ID = 'template_d3isckc';

  // DOM elements
  const hireTanksCheckbox = document.getElementById('hireTanksCheckbox');
  const tankNumberDiv = document.getElementById('tankNumberDiv');
  const tankNumber = document.getElementById('tankNumber');
  const tankCost = document.getElementById('tankCost');
  const totalCostDisplay = document.getElementById('totalCost');

  const addVarietiesCheckbox = document.getElementById('addVarietiesCheckbox');
  const varietiesContainer = document.getElementById('varietiesContainer');
  const addVarietyBtn = document.getElementById('addVarietyBtn');

  const addPetsCheckbox = document.getElementById('addPetsCheckbox');
  const petsContainer = document.getElementById('petsContainer');
  const addPetBtn = document.getElementById('addPetBtn');

  /*************** Tank cost logic ***************/
  hireTanksCheckbox.addEventListener('change', () => {
    tankNumberDiv.classList.toggle('hidden', !hireTanksCheckbox.checked);
    updateTankCost();
    updateTotalCost();
  });
  tankNumber.addEventListener('input', () => { updateTankCost(); updateTotalCost(); });

  function updateTankCost() {
    const num = Math.min(Math.max(parseInt(tankNumber.value) || 1, 1), 2);
    tankCost.innerText = (num * 1.5).toFixed(2);
  }

  /*************** Varieties logic ***************/
  addVarietiesCheckbox.addEventListener('change', () => {
    varietiesContainer.classList.toggle('hidden', !addVarietiesCheckbox.checked);
    addVarietyBtn.classList.toggle('hidden', !addVarietiesCheckbox.checked);
    if(addVarietiesCheckbox.checked && varietiesContainer.children.length === 0) addVariety();
    updateTotalCost();
  });
  addVarietyBtn.addEventListener('click', () => { addVariety(); updateTotalCost(); });

  function addVariety() {
    const div = document.createElement('div');
    div.className = 'subsection';
    const index = varietiesContainer.children.length;
    div.innerHTML = `
      <div class="subsection-header">Exhibit ${index + 1} (click to toggle)</div>
      <div class="subsection-content">
        <label>Rat Name:
          <input type="text" name="ratName${index}">
        </label>
        <div class="flex-row">
          <label>Age:
            <input type="radio" name="age${index}" value="Adult"> Adult
            <input type="radio" name="age${index}" value="Kitten"> Kitten
          </label>
          <label>Sex:
            <input type="radio" name="sex${index}" value="Doe"> Doe
            <input type="radio" name="sex${index}" value="Buck"> Buck
          </label>
        </div>
        <label>Section:
          <select name="section${index}" class="sectionSelect">
            <option value="">Select Section</option>
            <option value="Provisional Standard">Provisional Standard</option>
            <option value="Self">Self</option>
            <option value="Marked">Marked</option>
            <option value="Russian">Russian</option>
            <option value="Shaded">Shaded</option>
            <option value="AOV">AOV</option>
            <option value="Rex">Rex</option>
            <option value="Dumbo">Dumbo</option>
            <option value="Guide Standard">Guide Standard</option>
          </select>
        </label>
        <label>Class:
          <select name="class${index}" class="classSelect"><option value="">Select Section first</option></select>
        </label>
        <label><input type="checkbox" name="novice${index}"> Novice</label>
        <label><input type="checkbox" name="dualEntry${index}"> Dual Entry (Pets)</label>
      </div>
    `;
    varietiesContainer.appendChild(div);

    // NEW: recalc when dual entry is toggled
    const dualCheckbox = div.querySelector('input[name^="dualEntry"]');
    if (dualCheckbox) {
      dualCheckbox.addEventListener('change', updateTotalCost);
    }

    const header = div.querySelector('.subsection-header');
    const content = div.querySelector('.subsection-content');
    content.style.display = 'block';
    header.addEventListener('click', () => { content.style.display = content.style.display === 'none' ? 'block' : 'none'; });

    const sectionSelect = div.querySelector('.sectionSelect');
    const classSelect = div.querySelector('.classSelect');
    sectionSelect.addEventListener('change', () => {
      const options = getClassOptions(sectionSelect.value);
      classSelect.innerHTML = '';
      options.forEach(opt => {
        const o = document.createElement('option');
        o.value = opt; o.innerText = opt;
        classSelect.appendChild(o);
      });
    });

    updateTotalCost();
  }

  function getClassOptions(section) {
    const data = {
      "Provisional Standard": ["Bareback","Chestnut","Cinnamon Chinchilla","Copper","Dwarf","Merle","Pink Eyed Ivory","Powder Blue","Tonkinese (Self type)","Tonkinese (Agouti type)","Variegated Downunder"],
      "Self": ["Pink Eyed White","Champagne","Buff","Platinum","Quicksilver","British Blue","Black Chocolate","Mink","Ivory","Lilac"],
      "Marked": ["Berkshire/Badger","Irish","Hooded","Variegated","Capped","Essex","Chinchilla","Squirrel","Roan/Striped Roan"],
      "Russian": ["Russian Blue","Russian Dove","Russian Buff","Russian Blue Agouti","Russian Dove Agouti","Russian Silver","Russian Topaz"],
      "Shaded": ["Argente Crème","Himalayan","Siamese","Blue Point Siamese","Burmese","Wheaten Burmese","Golden Himalayan","Golden Siamese","Marten","Silver Agouti","Cream Agouti"],
      "AOV": ["Cream","Topaz","Silver Fawn","Silver","Agouti","Cinnamon","British Blue Agouti","Lilac Agouti","Pearl","Cinnamon Pearl","Platinum Agouti"],
      "Rex": ["Self","Marked","Russian","Shaded","AOV"],
      "Dumbo": ["Self","Marked","Russian","Shaded","AOV","Rex"],
      "Guide Standard": ["Blue Point Himalayan","Russian Burmese","Russian Silver Agouti","Sable Burmese","Spotted Down Under","Silken"]
    };
    return data[section] || [];
  }

  /*************** Pets logic ***************/
  addPetsCheckbox.addEventListener('change', () => {
    petsContainer.classList.toggle('hidden', !addPetsCheckbox.checked);
    addPetBtn.classList.toggle('hidden', !addPetsCheckbox.checked);
    if(addPetsCheckbox.checked && petsContainer.children.length === 0) addPet();
    updateTotalCost();
  });
  addPetBtn.addEventListener('click', () => { addPet(); updateTotalCost(); });

  function addPet() {
    const div = document.createElement('div');
    div.className = 'subsection';
    const index = petsContainer.children.length;
    div.innerHTML = `
      <div class="subsection-header">Pet ${index + 1} (click to toggle)</div>
      <div class="subsection-content">
        <label>Rat Name:
          <input type="text" name="petName${index}">
        </label>
        <label>Section:
          <select name="petSection${index}">
            <option value="">Select Section</option>
            <option value="Adult Owned">Adult Owned</option>
            <option value="Junior Owned">Junior Owned</option>
            <option value="Breeder Owned">Breeder Owned</option>
          </select>
        </label>
        <label>Sex:
          <input type="radio" name="petSex${index}" value="Buck"> Buck
          <input type="radio" name="petSex${index}" value="Doe"> Doe
        </label>
      </div>
    `;
    petsContainer.appendChild(div);

    const header = div.querySelector('.subsection-header');
    const content = div.querySelector('.subsection-content');
    content.style.display = 'block';
    header.addEventListener('click', () => { content.style.display = content.style.display === 'none' ? 'block' : 'none'; });

    updateTotalCost();
  }

  /*************** Total cost (with dual entry) ***************/
  function updateTotalCost() {
    let total = 0;

    // Tanks: £1.50 each, max 2
    if(hireTanksCheckbox.checked) {
      total += Math.min(parseInt(tankNumber.value) || 0, 2) * 1.5;
    }

    // £1 per variety and £1 per pet
    total += varietiesContainer.children.length + petsContainer.children.length;

    // +£1 for each Dual Entry (Pets) ticked
    const dualChecks = document.querySelectorAll('input[name^="dualEntry"]');
    dualChecks.forEach(cb => {
      if (cb.checked) total += 1;
    });

    totalCostDisplay.innerText = total.toFixed(2);
  }

  /*************** Form submission via EmailJS ***************/
  document.getElementById('entryForm').addEventListener('submit', function(event){
    event.preventDefault();
    emailjs.sendForm(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, this)
      .then(() => { alert('Entry submitted successfully!'); },
            (error) => { alert('Submission failed: ' + JSON.stringify(error)); });
  });

</script>

</body>
</html>

