<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LSCMRC Entry Form – Modern UI</title>
<style>
    body {
        font-family: Arial, sans-serif !important;
        background:#f5f5f5;
        margin:0;
        padding:20px;
    }
    .container {
        max-width:900px;
        margin:auto;
    }
    .card {
        background:white;
        border-radius:16px;
        padding:20px;
        margin-bottom:20px;
        box-shadow:0 4px 12px rgba(0,0,0,0.08);
    }
    h2 {
        margin-top:0;
    }
    label { display:block; margin-bottom:6px; font-weight: normal; text-align:left; }
    input, select, textarea {
        width:100%;
        padding:10px;
        margin-top:5px;
        border-radius:8px;
        border:1px solid #ccc;
        font-size:1rem;
    }
    .checkbox-row {
        display:flex;
        gap:10px;
        align-items:center;
        margin-top:10px;
    }
    .checkbox-row label {
        margin:0;
    }
    .add-btn {
        background:#0066ff;
        color:white;
        padding:10px 16px;
        border:none;
        border-radius:10px;
        cursor:pointer;
        margin-top:15px;
        font-size:1rem;
    }
    .add-btn:hover { background:#004ccc; }
    .total-box {
        background:#e8f0ff;
        padding:15px;
        border-radius:12px;
        font-size:1.2rem;
        text-align:center;
    }
</style>
</head>

<body>
<div class="container">
<form id="entryForm">

    <!-- MEMBER INFO -->
    <div class="card">
        <h2>Member Information</h2>

        <label>Name or Stud Name</label>
        <input type="text" name="memberName" required />

        <label>Email</label>
        <input type="email" name="memberEmail" required />

        <label>Phone</label>
        <input type="text" name="memberPhone" />

        <div class="checkbox-row">
            <input type="checkbox" id="lscmrcMember" name="lscmrcMember" />
            <label for="lscmrcMember">LSCMRC Member</label>
        </div>

        <div class="checkbox-row">
            <input type="checkbox" id="junior" name="junior" />
            <label for="junior">Junior (Under 16)</label>
        </div>
    </div>

    <!-- TANK HIRE -->
    <div class="card">
        <h2>Hire Tanks</h2>
        <div class="checkbox-row">
            <input type="checkbox" id="hireTanks" name="hireTanks" />
            <label for="hireTanks">Hire Tanks Required</label>
        </div>

        <div id="tankNumberBox" style="display:none;">
            <label>Number of Tanks (max 2)</label>
            <input type="number" id="tankCount" name="tankCount" min="0" max="2" value="0" />
        </div>
    </div>

    <!-- VARIETY EXHIBITS -->
    <div class="card">
        <h2>Show Entries – Varieties</h2>
        <div class="checkbox-row">
            <input type="checkbox" id="addVarieties" />
            <label for="addVarieties">Add Varieties</label>
        </div>

        <div id="varietyList"></div>
        <button class="add-btn" id="addVarietyBtn" type="button" style="display:none;">Add Another Variety</button>
    </div>

    <!-- PET ENTRIES -->
    <div class="card">
        <h2>Pets</h2>
        <div class="checkbox-row">
            <input type="checkbox" id="addPets" />
            <label for="addPets">Add Pets</label>
        </div>

        <div id="petList"></div>
        <button class="add-btn" id="addPetBtn" type="button" style="display:none;">Add Another Pet</button>
    </div>

    <!-- ADDITIONAL INFO -->
    <div class="card">
        <h2>Additional Information</h2>
        <textarea name="extraInfo" rows="4"></textarea>
    </div>

    <!-- TOTAL COST -->
    <div class="card total-box" id="totalCostBox">
        Total: £0.00
        <!-- hidden field so EmailJS gets the total -->
        <input type="hidden" name="total_cost" id="totalCostField" />
    </div>

    <!-- SUBMIT -->
    <div class="card">
        <button class="add-btn" type="submit">Submit Entry</button>
    </div>

</form>
</div>

<!-- EmailJS library -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
/***************  EMAILJS SETUP  ***************/
emailjs.init("3ZKJ9Faj6dDLhNh5Y"); // Public key

const EMAILJS_SERVICE_ID = "service_51m2sqm";
const EMAILJS_TEMPLATE_ID = "template_d3isckc";

/***************  COST + DYNAMIC FIELDS  ***************/
let total = 0;
const totalBox = document.getElementById('totalCostBox');
const totalCostField = document.getElementById('totalCostField');

function updateTotal() {
    let cost = 0;

    // Tanks
    const hire = document.getElementById('hireTanks').checked;
    if (hire) {
        const tanks = Number(document.getElementById('tankCount').value || 0);
        cost += tanks * 1.5;
    }

    // Varieties – £1 per variety, +£1 if dual entry
    document.querySelectorAll('.variety-entry').forEach(v => {
        cost += 1; // base cost
        const dual = v.querySelector('.dualCheck').checked;
        if (dual) cost += 1; // dual entry cost
    });

    // Pets – £1 per pet
    document.querySelectorAll('.pet-entry').forEach(p => {
        cost += 1;
    });

    total = cost;
    const text = `Total: £${total.toFixed(2)}`;
    totalBox.textContent = text;
    // re-append hidden input (since textContent clears children)
    totalBox.appendChild(totalCostField);
    totalCostField.value = total.toFixed(2);
}

// Variety handling
const addVarieties = document.getElementById('addVarieties');
const varietyList = document.getElementById('varietyList');
const addVarietyBtn = document.getElementById('addVarietyBtn');

addVarieties.addEventListener('change', () => {
    if (addVarieties.checked) {
        addVarietyBtn.style.display = 'block';
        if (!varietyList.children.length) {
            addVariety();
        }
    } else {
        varietyList.innerHTML = '';
        addVarietyBtn.style.display = 'none';
        updateTotal();
    }
});

function addVariety() {
    const index = varietyList.children.length;
    const div = document.createElement('div');
    div.className = 'card variety-entry';
    div.innerHTML = `
        <label>Rat Name</label>
        <input type="text" name="varietyName_${index}" />
        <label>Age</label>
        <select name="varietyAge_${index}">
            <option value="Adult">Adult (14+ weeks)</option>
            <option value="Kitten">Kitten (under 14 weeks)</option>
        </select>
        <label>Sex</label>
        <select name="varietySex_${index}">
            <option value="Doe">Doe</option>
            <option value="Buck">Buck</option>
        </select>
        <div class="checkbox-row">
            <input type="checkbox" class="dualCheck" name="varietyDual_${index}" id="varietyDual_${index}" />
            <label for="varietyDual_${index}">Dual Entry (Pets)</label>
        </div>
    `;
    varietyList.appendChild(div);
    div.querySelector('.dualCheck').addEventListener('change', updateTotal);
    updateTotal();
}
addVarietyBtn.addEventListener('click', addVariety);

// Pets handling
const addPets = document.getElementById('addPets');
const petList = document.getElementById('petList');
const addPetBtn = document.getElementById('addPetBtn');

addPets.addEventListener('change', () => {
    if (addPets.checked) {
        addPetBtn.style.display = 'block';
        if (!petList.children.length) {
            addPet();
        }
    } else {
        petList.innerHTML = '';
        addPetBtn.style.display = 'none';
        updateTotal();
    }
});

function addPet() {
    const index = petList.children.length;
    const div = document.createElement('div');
    div.className = 'card pet-entry';
    div.innerHTML = `
        <label>Rat Name</label>
        <input type="text" name="petName_${index}" />
        <label>Section</label>
        <select name="petSection_${index}">
            <option value="Adult Owned">Adult Owned</option>
            <option value="Junior Owned">Junior Owned</option>
            <option value="Breeder Owned">Breeder Owned</option>
        </select>
        <label>Sex</label>
        <select name="petSex_${index}">
            <option value="Buck">Buck</option>
            <option value="Doe">Doe</option>
        </select>
    `;
    petList.appendChild(div);
    updateTotal();
}
addPetBtn.addEventListener('click', addPet);

// Tanks
const hireTanks = document.getElementById('hireTanks');
hireTanks.addEventListener('change', () => {
    document.getElementById('tankNumberBox').style.display = hireTanks.checked ? 'block' : 'none';
    updateTotal();
});

document.getElementById('tankCount').addEventListener('input', updateTotal);

/***************  FORM SUBMISSION (EMAILJS)  ***************/
const form = document.getElementById('entryForm');

form.addEventListener('submit', function (event) {
    event.preventDefault();

    emailjs
        .sendForm(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, this)
        .then(() => {
            alert('Entry submitted successfully!');
            // Reset form & dynamic bits
            form.reset();
            varietyList.innerHTML = '';
            petList.innerHTML = '';
            document.getElementById('tankNumberBox').style.display = 'none';
            addVarietyBtn.style.display = 'none';
            addPetBtn.style.display = 'none';
            updateTotal();
        })
        .catch((error) => {
            console.error(error);
            alert('Submission failed – please try again or contact the show secretary.');
        });
});

// Initialise total field on first load
updateTotal();
</script>

</body>
</html>

